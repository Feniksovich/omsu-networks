# 2. Перераспределение маршрутов между RIP и OSPF
**Перераспределение маршрутов протоколом маршрутизации** — это передача ему маршрутов, полученных статически или с помощью другого протокола маршрутизации. 

В OSPF-сети маршрутизатор автоматически становится ASBR *(Autonomous System Boundary Router)*, если на нем сконфигурировано перераспределение маршрутов с помощью команды `redistribute`.

Это означает, что маршруты, полученные из других сетевых протоколов (например, BGP, RIP или статических маршрутов), которые не принадлежат самой OSPF-системе, будут введены в OSPF и распространены среди всех ее участников.

## Команды
Команда `redistribute` выполняется в режиме `config-router`
```yaml
redistribute <prtcl> [prcss-id] [metric <vl>] [metric-type <vl>] [subnets]
```
- `<prtcl>` — протокол маршрутизации, запущенный на том же маршрутизаторе, на котором задаётся команда, и чьи маршруты будут
перераспределяться маршрутизатором в OSPF-систему;
- `[prcss-id]` — идентификатор процесса, реализующего протокол маршрутизации;
- `[metric <vl>]` — указанное значение vl добавляется к метрике маршрута при его перераспределении в OSPF-систему;
- `[metric-type <vl>]` — указанное значение vl определяет способ задания метрики для внешнего маршрута при его передаче в OSPFсистему;
- `[subnets]` — указывает на то, что маршруты в сети, разбитые на подсети, также должны перераспределяться. По умолчанию такие маршруты не перераспределяются.

Отобразить конфигурацию маршрутов
```yaml
show ip route
```

## Вводная информация
| Сеть        | Адрес       | Маска подсети   | Протокол      |
|------------ |-------------|-----------------| ------------- |
| A (слева)   | 192.168.1.0 | 255.255.255.0   | RIP           |
| B (справа)  | 192.168.2.0 | 255.255.255.0   | OSPF (area 1) |
| M (M1 ↔ M2) | 10.0.1.0    | 255.255.255.0   | OSPF (area 0) |

### Топология
![topology](https://i.imgur.com/ZpPc7yI.png)

## Базовая конфигурация сети
### Маршрутизатор M1
```yaml
int fa0/0
    ip address 192.168.1.1 255.255.255.0
    no shutdown
    exit
    
int s2/0
    ip address 10.0.1.0 255.255.255.0
    no shutdown
    exit
```
Маршрутизатор M1 будет связывать две сети *(в терминах OSPF будет являться ASBR)*, маршрутизация в которых будет выполняться по двум разным протоколам: для сети `192.168.1.0/24` – RIP, для `10.0.1.0/24` – OSPF.

Сконфигурируем маршрутизацию для сети `192.168.1.0/24` по RIP:
```yaml
router rip
    network 192.168.1.0
```

Сконфигурируем маршрутизацию для сети `10.0.1.0/24` по OSPF:
```yaml
router ospf 1
    network 10.0.1.0 0.0.0.255 area 0
```

Для каждого из протоколов включим перераспределение маршрутов:
```yaml
router rip
    redist ospf 1
    exit

router ospf 1
    redist rip subnets
    exit
```

### Маршрутизатор M2
Машрутизация в сети `192.168.2.0/24` будет осуществляться по протоколу OSPF. Маршрутизатор M2 связывает две области OSPF-системы – *в терминах OSPF является ABR*.
```yaml
int fa0/0
    ip address 192.168.2.1 255.255.255.0
    no shutdown
    exit

int s2/0
    ip address 10.0.1.2 255.255.255.0
    no shutdown
    exit
```
Сконфигурируем OSPF:
```yaml
router ospf 1
    network 10.0.1.0 0.0.0.255 area 0
    network 192.168.2.0 0.0.0.255 area 1
    exit
```

## Проверка конфигурации и распределения маршрутов
```yaml
show ip route
```

### Маршрутизатор M1
```yaml
Gateway of last resort is not set

     10.0.0.0/24 is subnetted, 1 subnets
C       10.0.1.0 is directly connected, Serial2/0
C    192.168.1.0/24 is directly connected, FastEthernet0/0
O IA 192.168.2.0/24 [110/65] via 10.0.1.2, 00:14:27, Serial2/0
```

### Маршрутизатор M2
```yaml
Gateway of last resort is not set

     10.0.0.0/24 is subnetted, 1 subnets
C       10.0.1.0 is directly connected, Serial2/0
O E2 192.168.1.0/24 [110/20] via 10.0.1.1, 00:14:58, Serial2/0
C    192.168.2.0/24 is directly connected, FastEthernet0/0
```
Рядом с сетью `192.168.1.0/24`, доступную через маршрутизатор M1, маркер:
- `O` говорит о том, что информация о маршруте передается по протоколу OSPF (поскольку маршрутизаторы M1 и M2 находятся в одной OSPF-системе).
- `E2` говорит о том, что это внешний маршрут, полученный в рамках распределения маршрутов *(с учетом только внешней стоимости)*.